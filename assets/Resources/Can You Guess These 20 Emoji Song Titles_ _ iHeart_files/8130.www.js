"use strict";(this.__LOADABLE_LOADED_CHUNKS__=this.__LOADABLE_LOADED_CHUNKS__||[]).push([[8130],{91316:(e,t,o)=>{o.d(t,{Z:()=>b});var n=o(77184),i=o(44596),r=o(17400),s=o(73665),a=o(9133),c=o(55237),l=o(26985),u=o(59967),d=o(83502),p=o(12665);function g(){return g=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e},g.apply(this,arguments)}const h=(0,r.ZP)(),f=`${window.location.protocol}//${window.location.host}/`;function w(e,t,o){const n=o.authResponse;if(!n||!n.accessToken){const e=new Error;return e.type="facebook",e.payload="[social.fb] No access token",t(e)}return e(n)}const y=function(e){this.config=e};function m(e,t){const o=`${t}${t.indexOf("?")>-1?"&":"?"}pname=fb&campid=s&keyid=${e}`;return`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent((0,l.v_)(f,o))}`}y.prototype.isReady=(0,n.Z)((function(){const e=this;return"undefined"==typeof window?Promise.reject(new Error("Facebook service is only available on browser")):new Promise(((e,t)=>{const o=(0,c.bM)(h.getState());(0,p.KB)().then((async()=>{setTimeout(t,5e3),await(0,i.Z)(`https://connect.facebook.net/${o}/sdk.js`,"facebookScript").then(e,t)}))})).then((()=>{if(!window.FB)throw new Error("FB is not initialized");window.FB.init({appId:e.config.fbAppId,channelUrl:`${f}misc/fb_channel/`,music:e.config.music,oauth:!0,status:!0,version:"v3.2",xfbml:!0})}))})),y.prototype.getFBSession=function(){return new Promise(((e,t)=>{window.FB.login(w.bind(null,e,t),{scope:"email,user_gender,user_location,user_birthday,user_link"})}))},y.prototype.login=function(e){return this.getFBSession().then(this._getProfile).then((({email:t,accessToken:o,userID:n})=>h.dispatch((0,u.R5)({accessToken:o,email:t,provider:"fb",signupFlow:e,userId:n}))))},y.prototype.link=function(e,t){return this.isReady().then((()=>new Promise(((e,t)=>{window.FB.login(w.bind(null,e,t),{scope:"email,user_gender,user_location,user_birthday,user_link"})})))).then((o=>(0,s.Z)((0,d.X0)({accessToken:o.accessToken,accessTokenType:"fb",ampUrl:(0,a.h_)(h.getState()),profileId:e,sessionId:t,uid:o.userID,useUnauthorizedInterceptor:!1})).then((()=>o.userID))))},y.prototype.backgroundLogin=function(){return this.isReady().then((()=>new Promise(((e,t)=>{window.FB.getLoginStatus((o=>{if(!o||"connected"!==o.status){const e=new Error("Attempted background login; FB did not provide a session");throw e.type="facebook",e.payload=o,e}return w(e,t,o)}))})))).then(this._getProfile).then((({email:e,accessToken:t,userID:o})=>h.dispatch((0,u.R5)({accessToken:t,email:e,provider:"fb",signupFlow:"default",userId:o}))))},y.prototype.parse=function(e){return this.isReady().then((()=>window.FB.XFBML.parse(e)))},y.prototype.getShareUrl=m,y.getShareUrl=m,y.prototype.getUserImageUrl=function(e){return this.isReady().then((()=>new Promise(((t,o)=>window.FB.api(`/${e}/picture`,{height:2e3,redirect:0,width:2e3},(e=>e?e.error?o(e.error):t(e.data.url):o(new Error("No FB Response"))))))))},y.prototype._getProfile=function(e){return new Promise(((t,o)=>window.FB.api("/me",(n=>n?n.error?o(n.error):t(g({},e,{email:n.email})):o(new Error("No FB Response"))))))};const b=y},68130:(e,t,o)=>{o.d(t,{s:()=>Y});var n=o(17),i=o(31589),r=o(91316),s=o(77184),a=o(44596),c=o(69164),l=o(17400),u=o(73665),d=o(9133),p=o(59967),g=o(83502),h=o(12665);const f=(0,l.ZP)();let w,y;function m(e){this.config={appId:e.appId,clientId:e.clientId,country:e.country},window.___gcfg={isSignedOut:!0,lang:e.lang,parsetags:"explicit"}}m.prototype.isReady=(0,s.Z)((function(){return new Promise(((e,t)=>{window.__gapiReady=()=>{y=window.gapi,y?y.load("auth2",(()=>{w=y.auth2.init({client_id:this.config.clientId,cookiepolicy:"single_host_origin",immediate:!1,requestvisibleactions:"http://schemas.google.com/ListenActivity",scope:"https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/userinfo.profile"}),e()})):t(new Error("gapi was not initialized"))},(0,h.KB)().then((async()=>{setTimeout(t,5e3),await(0,a.Z)("https://apis.google.com/js/client:platform.js?onload=__gapiReady","gPlusScript").then(void 0,t)}))}))})),m.prototype.signin=function(){return this._gaSignin().then(this._getProfile).then((({email:e,access_token:t,id:o})=>f.dispatch((0,p.R5)({accessToken:t,email:e,provider:"google",signupFlow:"default",userId:o}))))},m.prototype.link=function(e,t){return this._gaSignin().then(this._getProfile).then((o=>(0,u.Z)((0,g.X0)({accessToken:o.access_token,accessTokenType:"google",ampUrl:(0,d.h_)(f.getState()),profileId:e,sessionId:t,uid:o.id})).then((()=>o.id))))},m.prototype._gaSignin=function(){return new Promise(((e,t)=>{if(w)w.signIn().then((()=>{const t=w.currentUser.get().getAuthResponse(),o=w.currentUser.get().getBasicProfile();e({access_token:t.access_token,email:o.getEmail(),id:o.getId()})})).catch((e=>{const o=e&&(e.error||e.description||e.message)||e,n=new Error(o);n.type="gplus",n.payload=o,c.ZP.error([c.Ke.AUTH,c.Ke.SOCIAL],o,{},n),t(n)}));else{const e=new Error("[Google error, auth2 is Undefined]");e.type="gplus",c.ZP.error([c.Ke.AUTH,c.Ke.SOCIAL],e.message,{},e),t(e)}}))},m.prototype._getProfile=function(e){return new Promise(((t,o)=>{if(!e||!e.access_token){const t=new Error("[Google error, User info is not complete. User access token is undefined]");return t.type="gplus",t.payload=e,o(t)}return t({access_token:e.access_token,email:e.email,id:e.id})}))};const b=m;var k=o(48763),_=o(94547),I=o(36429),v=o(40826),P=o.n(v),S=o(26985),T=o(32034),U=o(85834),R=o(50521),F=o(55237),A=o(66542);function E(e){this.message=e}E.prototype=new Error,E.prototype.name="InvalidCharacterError";var C="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new E("'atob' failed: The string to be decoded is not correctly encoded.");for(var o,n,i=0,r=0,s="";n=t.charAt(r++);~n&&(o=i%4?64*o+n:n,i++%4)?s+=String.fromCharCode(255&o>>(-2*i&6)):0)n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);return s};function Z(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(C(e).replace(/(.)/g,(function(e,t){var o=t.charCodeAt(0).toString(16).toUpperCase();return o.length<2&&(o="0"+o),"%"+o})))}(t)}catch(e){return C(t)}}function L(e){this.message=e}L.prototype=new Error,L.prototype.name="InvalidTokenError";var B=o(85415),K=o(9423);let O;const j=(0,l.ZP)(),H=(0,A.v)(j.getState()),D=()=>{j.dispatch((0,K.j_)({title:H("Login unsuccessful. Please try again later."),sticky:!0}))},G=(0,B.z5)({initialize({appKey:e}){if(!e)return!1;const t=document.createElement("script");return t.id="google-sdk",t.src="https://accounts.google.com/gsi/client",t.async=!0,t.defer=!0,document.body.append(t),new Promise(((o,n)=>{t.addEventListener("load",(()=>{O=google.accounts.oauth2.initCodeClient({client_id:e,callback:async e=>{if(!(0,B.Kn)(e)||!(0,B.HD)(e.code))return D(),void n();const t=await(0,u.Z)({method:"GET",url:"/api/v1/google/exchange-code/",params:{code:e.code}});if(200===t.status){const{accessToken:e,idToken:o}=t.data,i=function(e,t){if("string"!=typeof e)throw new L("Invalid token specified");var o=!0===(t=t||{}).header?0:1;try{return JSON.parse(Z(e.split(".")[o]))}catch(e){throw new L("Invalid token specified: "+e.message)}}(o);i.sub?j.dispatch((0,p.R5)({accessToken:e,email:i.email,provider:"google",signupFlow:"default",userId:i.sub})):(c.ZP.error([c.Ke.AUTH,c.Ke.SOCIAL],"Google JWT unable to be decoded"),D(),n())}else c.ZP.error([c.Ke.AUTH,c.Ke.SOCIAL],"Google code exchange failed"),D(),n()},scope:"profile email openid"}),o(!0)}))}))},login(){O.requestCode?O.requestCode():(c.ZP.error([c.Ke.AUTH,c.Ke.SOCIAL],"Unable to request code from Google code client"),D())},remove(){var e;null==(e=document.querySelector("script#google-sdk"))||e.remove()}});var $=o(3124);const x=(0,l.ZP)(),z=(0,T.zB)({isAuthenticated:U.j3}),J={fb:"Facebook",gplus:"Google"},N=P()((()=>z(x.getState()))),q=P()((()=>z(x.getState()))),M="facebook-warning-shown";function Q(){const e=x.getState(),{isAuthenticated:t}=z(e);t&&this.userChanged(),x.subscribe(N((()=>{this.userChanged()}))),this.tw=i,this.gplus=new b({clientId:(0,R.QJ)(e),country:(0,d.so)(e),lang:(0,F.VQ)(e)}),this.google=G,this.google.initialize({appKey:(0,R.QJ)(e),clientSecret:(0,R.q1)(e)}),this._initFbBridge()}Q.prototype._initFbBridge=function(){const e=(0,U.Ld)(x.getState()),t=(0,S.IO)();let o;if(o=decodeURIComponent(t.radio_station||t.musician||""),o&&(o=(0,S.F1)(o,{autoplay:!0})),e&&(t.fb_auto_login||o))return this.isReady().then(this.backgroundLogin.bind(this,"fb"));o&&(window.location=o)},Q.prototype.userChanged=function(){const e=x.getState(),{isAnonymous:t}=(0,U.Ld)(e);this.fb=new r.Z({country:(0,d.so)(e),fbAppId:(0,R.iJ)(e),music:!t})},Q.prototype.isReady=function(){return Promise.all([this.isGoogleReady(),this.isFacebookReady()])},Q.prototype.isGoogleReady=function(){return this.gplus.isReady()},Q.prototype.isFacebookReady=function(){return new Promise(((e,t)=>{const{isAuthenticated:o}=z(x.getState());if("/sdk/auth/"===window.location.pathname)this.userChanged(),this.initFacebook().then(e);else if(o)this.initFacebook().then(e);else{const t=x.subscribe(q((()=>{t(),this.userChanged(),this.initFacebook().then(e)})))}}))},Q.prototype.initFacebook=function(){return this.fb.isReady().then(void 0,(()=>{_.Z.getItem(M,null)&&(_.Z.setItem(M,1),_.Z.setItem(I.Z.SocialTimeout,1))}))},Q.prototype.backgroundLogin=function(e){return"fb"===e?this.fb.backgroundLogin():Promise.reject(new Error("Unsupported social type"))},Q.prototype.link=function(e){const t=x.getState(),o=(0,A.v)(t),{profileId:i,sessionId:r}=(0,U.UR)(t),s="fb"===e,a=J[e];return this.isReady().then((()=>s?this.fb.link(i,r):this.gplus.link(i,r))).then((e=>{x.dispatch((0,$.MJ)(s?"facebookId":"googlePlusId",e)),k.Z.trigger(k.E.AUTHENTICATED,s?"facebook":"gplus"),x.dispatch((0,K.j_)({title:o("Update successful."),description:o("Your account has been linked to {provider}.",{provider:s?"Facebook":"Google"})}))})).catch((e=>{c.ZP.error([c.Ke.AUTH,c.Ke.SOCIAL],{},{},e),(0,n.Z)(e,["response","data","errors"],[]).forEach((({code:e})=>{2===e?x.dispatch((0,K.j_)({title:o("This {accountType} account is already linked to an iHeartRadio account",{accountType:a})})):x.dispatch((0,K.j_)({title:o("{accountType} account linking failed. Please try again later.",{accountType:a})}))}))}))},Q.prototype.unlink=function(e){return this.isReady().then((()=>{const t=x.getState(),o=(0,A.v)(t),n="fb"===e,i=J[e],{profileId:r,sessionId:s}=(0,U.UR)(t);return(0,u.Z)((0,g.Gr)({ampUrl:(0,d.h_)(t),profileId:r,provider:e,sessionId:s})).then((()=>{x.dispatch((0,$.MJ)(n?"facebookId":"googlePlusId",null)),x.dispatch((0,K.j_)({title:o("Update successful."),description:o("Your account has been unlinked from {provider}.",{provider:n?"Facebook":"Google"})}))}),(()=>{x.dispatch((0,K.j_)({title:o("{accountType} account unlinking failed. Please try again later.",{accountType:i})}))}))}))},Q.prototype.parse=function(e){if("fb"===e)return this.fb.parse()},Q.prototype.login=function(e){const t=x.getState(),o=(0,A.v)(t),n={facebook:()=>this.fb.login(),googleplus:()=>this.google.login()};return this.isReady().then((()=>n[e]().catch((e=>{c.ZP.error([c.Ke.AUTH,c.Ke.SOCIAL],{},{},e);const t="popup_closed_by_user"===e.payload?o("Login unsuccessful. Window closed before completion. Please try again."):o("Login unsuccessful. Please try again later.");x.dispatch((0,K.j_)({title:t,sticky:!0}))}))))},Q.prototype.checkForPopUpError=function(e){if(["popup_closed_by_user","popup_blocked_by_browser"].includes(e)){const e=x.getState(),t=(0,A.v)(e);return x.dispatch((0,K.j_)({title:t("Do You Have a Popup Blocker?"),description:t("To log in with your Facebook or Google account, ensure you've allowed popups from www.iheart.com, refresh, and then try again."),sticky:!0})),!0}return!1},Q.prototype.getUserImageUrl=function(e,t){if("fb"===e)return this.fb.getUserImageUrl(t)};const X=new Q,Y=()=>X},31589:(e,t,o)=>{o.r(t),o.d(t,{getShareUrl:()=>s,getTweetUrl:()=>a});var n=o(26985);const i=`${window.location.protocol}//${window.location.host}/`;function r(e,t,o=""){return`http://twitter.com/share?${(0,n.wu)({related:"iHeartRadio",screen_name:o,text:e,url:(0,n.v_)(i,t)})}`}function s(e,t){return r(`I’m listening to ${t} ♫ @iHeartRadio`,e)}function a(e){return e?r("","",e.replace(/@/g,"").trim()):""}}}]);
//# sourceMappingURL=8130.www.js.map